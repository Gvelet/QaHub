!function(){class e{constructor(){this.articles=[],this.currentPage=1,this.itemsPerPage=9,this.currentCategory="all"}async init(){if(await this.loadArticles(),document.getElementById("homeBlogCards")&&this.renderHome(),document.getElementById("blogCards")){const e=new URLSearchParams(window.location.search),t=parseInt(e.get("page")||"1",10);this.currentPage=isNaN(t)?1:t,this.createCategoryFilters(),this.setupFilters(),this.renderPage(this.currentPage,this.currentCategory,{scroll:!1})}}async loadArticles(){try{const e=await fetch("../files/articles.json");if(!e.ok)throw new Error("articles.json not found");const t=await e.json();this.articles=(t||[]).map((e=>({slug:e.slug,title:e.title,description:e.description,image:e.image||"/images/bg.webp",category:e.category||"",date:e.date||"",url:`./${e.slug}`,showOnHome:Boolean(e.showOnHome)}))),this.articles.sort(((e,t)=>new Date(t.date)-new Date(e.date)))}catch(e){console.error("Не удалось загрузить articles.json",e),this.articles=[]}}createCardHTML(e){return`\n    <a href="${e.url}" class="blog__card">\n      <img src="${e.image}" alt="${e.title}" class="blog__card-img" loading="lazy">\n\n      <div class="blog__card-content">\n        <span class="blog__card-category blog__card-category--top">${e.category}</span>\n\n        <h3 class="blog__card-title">${e.title}</h3>\n        <p class="blog__card-desc">${e.description}</p>\n\n        <div class="blog__card-meta">\n          <span class="blog__card-date">${this.formatDate(e.date)}</span>\n        </div>\n      </div>\n    </a>\n  `}createHomeCardHTML(e){return`\n    <div class="swiper-slide blog__card" id='blog__cards'>\n        <a href="blog/${e.url}" class="blog__card test-${e.url}">\n        <img src="${e.image}" alt="${e.title}" class="blog__card-img" loading="lazy">\n\n        <div class="blog__card-content">\n            <span class="blog__card-category blog__card-category--top">${e.category}</span>\n\n            <h3 class="blog__card-title">${e.title}</h3>\n            <p class="blog__card-desc">${e.description}</p>\n\n            <div class="blog__card-meta">\n            <span class="blog__card-date">${this.formatDate(e.date)}</span>\n            </div>\n        </div>\n        </a>\n    </div>\n  `}formatDate(e){if(!e)return"";const t=new Date(e);return isNaN(t)?e:`${t.getDate().toString().padStart(2,"0")} ${["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"][t.getMonth()]} ${t.getFullYear()}`}renderHome(){const e=document.getElementById("homeBlogCards");if(!e)return;e.innerHTML="";let t=this.articles.filter((e=>e.showOnHome));if(t.length<3){const e=this.articles.filter((e=>!e.showOnHome));t=t.concat(e).slice(0,3)}else t=t.sort(((e,t)=>new Date(t.date)-new Date(e.date))).slice(0,3);t.forEach((t=>{e.insertAdjacentHTML("beforeend",this.createHomeCardHTML(t))}))}createCategoryFilters(){const e=document.getElementById("blogFilter");if(!e)return;const t=e.querySelector('[data-category="all"]');e.innerHTML="",t&&(t.classList.add("active"),e.appendChild(t));const a=new Set;this.articles.forEach((e=>{if(!e.category)return;const t=e.category.toString().trim();if(!t)return;const r=t.toLowerCase(),s=t.charAt(0).toUpperCase()+t.slice(1);a.add(JSON.stringify({key:r,label:s}))})),Array.from(a).map((e=>JSON.parse(e))).sort(((e,t)=>e.label.localeCompare(t.label,"ru"))).forEach((t=>{const a=document.createElement("button");a.className="blog-filter-btn",a.dataset.category=t.key,a.textContent=t.label,e.appendChild(a)}))}updatePageParam(e){const t=new URL(window.location.href);1===e?t.searchParams.delete("page"):t.searchParams.set("page",e),window.history.replaceState(null,"",t.toString())}renderPage(e,t,{scroll:a=!1}={}){const r=document.getElementById("blogCards"),s=document.getElementById("blogPagination"),n=document.getElementById("blogEmpty");if(!r)return;let o=this.articles;if(t&&"all"!==t){const e=t.toLowerCase();o=o.filter((t=>(t.category||"").toLowerCase().includes(e)))}const l=Math.ceil(o.length/this.itemsPerPage)||1,c=Math.min(Math.max(e,1),l),i=(c-1)*this.itemsPerPage,d=i+this.itemsPerPage,g=o.slice(i,d);if(r.innerHTML="",g.forEach((e=>{r.insertAdjacentHTML("beforeend",this.createCardHTML(e))})),n&&(n.style.display=g.length?"none":"block"),s&&(s.innerHTML="",l>1))for(let e=1;e<=l;e++){const t=document.createElement("button");t.className="blog-pagination-btn "+(e===c?"active":""),t.textContent=e,t.addEventListener("click",(()=>{this.currentPage=e,this.renderPage(e,this.currentCategory||"all",{scroll:!0})})),s.appendChild(t)}if(this.currentPage=c,this.updatePageParam(c),a){const e=r.getBoundingClientRect().top+window.scrollY-80;window.scrollTo({top:e,behavior:"smooth"})}}setupFilters(){const e=document.querySelectorAll(".blog-filter-btn");e.length&&(this.currentCategory="all",e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>e.classList.remove("active"))),t.classList.add("active");const a=t.dataset.category||"all";this.currentCategory=a,this.renderPage(1,a,{scroll:!1})}))})))}}document.addEventListener("DOMContentLoaded",(()=>{(new e).init()}))}();
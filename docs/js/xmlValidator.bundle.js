new class{constructor(){this.editor=document.getElementById("editor"),this.panel=document.getElementById("editorPanel"),this.lines=document.getElementById("lines"),this.status=document.getElementById("status"),this.examplesSelect=document.getElementById("examples"),this.copyBtn=document.getElementById("copyBtn"),this.exportBtn=document.getElementById("exportBtn"),this.buttons={check:document.getElementById("check"),format:document.getElementById("format"),minify:document.getElementById("minify"),clear:document.getElementById("clear")},this.statusTimeout=null,this.init()}init(){Object.values(this.buttons).forEach((e=>{e.onclick=()=>this.handleBtn(e.id)})),this.copyBtn.onclick=()=>this.copy(),this.exportBtn.onclick=()=>this.exportXml(),this.examplesSelect.onchange=e=>{e.target.value&&(this.loadExample(e.target.value),e.target.value="")},this.editor.oninput=this.onInput.bind(this),this.editor.onscroll=this.syncScroll.bind(this),document.onkeydown=e=>{e.ctrlKey&&"Enter"===e.key&&(e.preventDefault(),this.validate())},this.renderLines()}loadExample(e){this.editor.value={"valid-mini":'<?xml version="1.0" encoding="UTF-8"?>\n<user>\n  <id>1</id>\n  <name>Тестовый пользователь</name>\n  <active>true</active>\n  <roles>\n    <role>user</role>\n    <role>tester</role>\n  </roles>\n</user>',"valid-large":'<?xml version="1.0" encoding="UTF-8"?>\n<apiResponse>\n  <meta>\n    <version>1.3.5</version>\n    <createdAt>2026-01-23T14:00:00.000Z</createdAt>\n    <isPublished>true</isPublished>\n    <tags>\n      <tag>api</tag>\n      <tag>testing</tag>\n      <tag>xml</tag>\n      <tag>example</tag>\n    </tags>\n  </meta>\n  <users>\n    <user id="1">\n      <login>user123</login>\n      <fullName>Иван Петров</fullName>\n      <email>user123@example.com</email>\n      <age>28</age>\n      <isVerified>true</isVerified>\n      <balance>1500.75</balance>\n      <countryCode>RU</countryCode>\n      <permissions>\n        <permission>read</permission>\n        <permission>write</permission>\n        <permission>admin</permission>\n      </permissions>\n      <preferences>\n        <theme>dark</theme>\n        <language>ru</language>\n        <notificationsEnabled>true</notificationsEnabled>\n        <maxItemsPerPage>20</maxItemsPerPage>\n      </preferences>\n      <createdAt>2024-03-15T10:30:00.123Z</createdAt>\n      <address>\n        <city>Екатеринбург</city>\n        <street>Ленина, 34</street>\n        <building>5</building>\n        <apartment>12</apartment>\n        <index>620000</index>\n      </address>\n    </user>\n    <user id="2">\n      <login>test_user</login>\n      <fullName>Тестовый Пользователь</fullName>\n      <email>test@example.com</email>\n      <age>0</age>\n      <isVerified>false</isVerified>\n      <balance>-100.5</balance>\n      <countryCode>US</countryCode>\n      <permissions/>\n      <preferences>\n        <theme>light</theme>\n        <language>en</language>\n        <notificationsEnabled>false</notificationsEnabled>\n        <maxItemsPerPage>10</maxItemsPerPage>\n      </preferences>\n      <createdAt>2025-12-01T00:00:00.000Z</createdAt>\n      <note>Этот пользователь используется для автоматических тестов.</note>\n      <archived>true</archived>\n    </user>\n  </users>\n  <orders>\n    <order id="ORD-0001">\n      <userId>1</userId>\n      <items>\n        <item>\n          <productId>P1001</productId>\n          <name>Смартфон XYZ</name>\n          <quantity>1</quantity>\n          <price>29999.99</price>\n          <discount>1000.0</discount>\n          <total>28999.99</total>\n          <currency>RUB</currency>\n        </item>\n      </items>\n      <totalPrice>32979.99</totalPrice>\n      <status>delivered</status>\n    </order>\n  </orders>\n  <config>\n    <maxConcurrentRequests>100</maxConcurrentRequests>\n    <rateLimit>\n      <requestsPerMinute>60</requestsPerMinute>\n      <burst>120</burst>\n    </rateLimit>\n  </config>\n  <stats>\n    <totalUsers>15000</totalUsers>\n    <activeUsers>3200</activeUsers>\n  </stats>\n</apiResponse>',invalid:'<?xml version="1.0" encoding="UTF-8"?>\n<user>\n  <id>1</id>\n  <name>Тест</name>\n  <status>active</status>\n</user'}[e],this.renderLines(),this.validate()}exportXml(){const e=this.editor.value,t=new Blob([e],{type:"application/xml"}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=`xml-export-${(new Date).toISOString().slice(0,10)}.xml`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s),this.showStatus("XML экспортирован!","success",!0)}onInput(){const e=!this.editor.value.trim();this.renderLines(),this.debounce(this.validate,400)(),e&&!this.editor.value.trim()&&this.hideStatus()}debounce(e,t){let s;return()=>{clearTimeout(s),s=setTimeout(e.bind(this),t)}}syncScroll(){this.lines.scrollTop=this.editor.scrollTop}renderLines(){const e=this.editor.value.split("\n");this.lines.innerHTML=e.map(((e,t)=>`<div class="xml-validator__line-num">${t+1}</div>`)).join("")}handleBtn(e){const t={check:()=>this.validate(),format:()=>this.format(),minify:()=>this.minify(),clear:()=>this.clear()};t[e]?.()}validate(){const e=this.editor.value.trim();if(this.panel.classList.remove("xml-validator__panel--error"),this.clearErrors(),!e)return void this.hideStatus();const t=(new DOMParser).parseFromString(e,"text/xml"),s=t.querySelector("parsererror");if(s||t.getElementsByTagName("parsererror").length>0){this.panel.classList.add("xml-validator__panel--error");const e=s?s.textContent:"Ошибка парсинга XML",t=this.getErrorLine(e);return this.highlightError(t),void this.showStatus(`Строка ${t}: ${e}`,"error",!1)}if(!t.documentElement)return this.panel.classList.add("xml-validator__panel--error"),this.highlightError(1),void this.showStatus("Отсутствует корневой элемент XML","error",!1);this.showStatus("XML валиден!","success",!0)}getErrorLine(e){const t=e.match(/line (\d+)/i);return t?parseInt(t[1]):1}highlightError(e){this.clearErrors();const t=this.lines.children[e-1];t&&(t.classList.add("xml-validator__line-num--error"),this.editor.scrollTop=20*(e-1))}clearErrors(){this.lines.querySelectorAll(".xml-validator__line-num--error").forEach((e=>{e.classList.remove("xml-validator__line-num--error")}))}format(){try{const e=(new DOMParser).parseFromString(this.editor.value,"text/xml");if(e.querySelector("parsererror"))throw new Error("Невалидный XML");let t=(new XMLSerializer).serializeToString(e);t.startsWith("<?xml")||(t='<?xml version="1.0" encoding="UTF-8"?>\n'+t),t=t.replace(/></g,">\n<"),t=t.replace(/\n\s*\n/g,"\n"),this.editor.value=t,this.renderLines(),this.validate()}catch(e){this.editor.value?this.showStatus("Невалидный XML!","error",!0):this.showStatus("Введите XML!","error",!0)}}minify(){try{const e=(new DOMParser).parseFromString(this.editor.value,"text/xml");if(e.querySelector("parsererror"))throw new Error("Невалидный XML");let t=(new XMLSerializer).serializeToString(e);t=t.replace(/\s+/g," ").replace(/> </g,"><"),t.startsWith("<?xml")||(t='<?xml version="1.0" encoding="UTF-8"?>'+t),this.editor.value=t,this.renderLines(),this.validate()}catch(e){this.editor.value?this.showStatus("Невалидный XML!","error",!0):this.showStatus("Введите XML!","error",!0)}}clear(){this.editor.value="",this.renderLines(),this.panel.classList.remove("xml-validator__panel--error"),this.hideStatus()}copy(){navigator.clipboard.writeText(this.editor.value).then((()=>{this.showStatus("Скопировано!","success",!0)})).catch((()=>{this.showStatus("Ошибка копирования","error",!0)}))}showStatus(e,t,s=!1){this.statusTimeout&&(clearTimeout(this.statusTimeout),this.statusTimeout=null),this.status.innerHTML=`\n      <span class="xml-validator__status-icon">${"success"===t?"✅":"❌"}</span>\n      <span>${e}</span>\n    `,this.status.className=`xml-validator__status xml-validator__status--${t}`,this.status.style.display="block",s&&(this.statusTimeout=setTimeout(this.hideStatus.bind(this),3e3))}hideStatus(){this.statusTimeout&&(clearTimeout(this.statusTimeout),this.statusTimeout=null),this.status.style.display="none"}};
new class{constructor(){this.editor=document.getElementById("editor"),this.panel=document.getElementById("editorPanel"),this.lines=document.getElementById("lines"),this.status=document.getElementById("status"),this.examplesSelect=document.getElementById("examples"),this.copyBtn=document.getElementById("copyBtn"),this.exportBtn=document.getElementById("exportBtn"),this.buttons={check:document.getElementById("check"),format:document.getElementById("format"),minify:document.getElementById("minify"),clear:document.getElementById("clear")},this.statusTimeout=null,this.init()}init(){Object.values(this.buttons).forEach((n=>{n.onclick=()=>this.handleBtn(n.id)})),this.copyBtn.onclick=()=>this.copy(),this.exportBtn.onclick=()=>this.exportJson(),this.examplesSelect.onchange=n=>{n.target.value&&(this.loadExample(n.target.value),n.target.value="")},this.editor.oninput=this.onInput.bind(this),this.editor.onscroll=this.syncScroll.bind(this),document.onkeydown=n=>{n.ctrlKey&&"Enter"===n.key&&(n.preventDefault(),this.validate())},this.renderLines()}loadExample(n){this.editor.value={"valid-mini":'{\n  "id": 1,\n  "name": "Тестовый пользователь",\n  "active": true,\n  "roles": ["user", "tester"]\n}',"valid-large":'{\n  "meta": {\n    "version": "1.3.5",\n    "createdAt": "2026-01-23T14:00:00.000Z",\n    "isPublished": true,\n    "tags": ["api", "testing", "json", "example"],\n    "extra": null\n  },\n\n  "users": [\n    {\n      "id": 1,\n      "login": "user123",\n      "fullName": "Иван Петров",\n      "email": "user123@example.com",\n      "age": 28,\n      "isVerified": true,\n      "balance": 1500.75,\n      "countryCode": "RU",\n      "permissions": ["read", "write", "admin"],\n      "preferences": {\n        "theme": "dark",\n        "language": "ru",\n        "notificationsEnabled": true,\n        "maxItemsPerPage": 20\n      },\n      "createdAt": "2024-03-15T10:30:00.123Z",\n      "lastActiveAt": "2026-01-22T18:45:22.345Z",\n      "address": {\n        "city": "Екатеринбург",\n        "street": "Ленина, 34",\n        "building": 5,\n        "apartment": 12,\n        "index": "620000"\n      },\n      "contacts": [\n        {\n          "type": "phone",\n          "value": "+79001234567",\n          "isPrimary": true\n        },\n        {\n          "type": "email",\n          "value": "user123@example.com",\n          "isPrimary": false\n        },\n        {\n          "type": "telegram",\n          "value": "@user123",\n          "isPrimary": false\n        }\n      ],\n      "profileImage": "https://example.com/images/user123.png",\n      "note": "",\n      "archived": false\n    },\n    {\n      "id": 2,\n      "login": "test_user",\n      "fullName": "Тестовый Пользователь",\n      "email": "test@example.com",\n      "age": 0,\n      "isVerified": false,\n      "balance": -100.5,\n      "countryCode": "US",\n      "permissions": [],\n      "preferences": {\n        "theme": "light",\n        "language": "en",\n        "notificationsEnabled": false,\n        "maxItemsPerPage": 10\n      },\n      "createdAt": "2025-12-01T00:00:00.000Z",\n      "lastActiveAt": null,\n      "address": null,\n      "contacts": [],\n      "profileImage": null,\n      "note": "Этот пользователь используется для автоматических тестов.",\n      "archived": true\n    },\n    {\n      "id": 3,\n      "login": "empty_fields",\n      "fullName": "",\n      "email": null,\n      "age": null,\n      "isVerified": null,\n      "balance": null,\n      "countryCode": null,\n      "permissions": null,\n      "preferences": null,\n      "createdAt": null,\n      "lastActiveAt": null,\n      "address": {},\n      "contacts": [],\n      "profileImage": null,\n      "note": "Почти все поля пустые или null.",\n      "archived": false\n    }\n  ],\n\n  "orders": [\n    {\n      "id": "ORD-0001",\n      "userId": 1,\n      "items": [\n        {\n          "productId": "P1001",\n          "name": "Смартфон XYZ",\n          "quantity": 1,\n          "price": 29999.99,\n          "discount": 1000.0,\n          "total": 28999.99,\n          "currency": "RUB",\n          "options": {\n            "color": "black",\n            "storage": "128GB",\n            "caseIncluded": true,\n            "extraGlasses": false\n          }\n        },\n        {\n          "productId": "P1002",\n          "name": "Чехол для XYZ",\n          "quantity": 2,\n          "price": 1990.0,\n          "discount": 0.0,\n          "total": 3980.0,\n          "currency": "RUB",\n          "options": {\n            "color": "red",\n            "material": "silicone"\n          }\n        }\n      ],\n      "totalPrice": 32979.99,\n      "discountTotal": 1000.0,\n      "currency": "RUB",\n      "status": "delivered",\n      "createdAt": "2025-11-20T12:10:00.000Z",\n      "updatedAt": "2025-12-05T15:30:45.111Z",\n      "deliveryAddress": {\n        "country": "Россия",\n        "region": "Свердловская область",\n        "city": "Екатеринбург",\n        "street": "Ленина, 34",\n        "building": 5,\n        "index": "620000"\n      },\n      "comments": [\n        {\n          "authorId": 1,\n          "text": "Пожалуйста, доставьте вечером после 18:00.",\n          "createdAt": "2025-11-20T12:11:00.000Z"\n        }\n      ],\n      "metadata": {\n        "source": "mobile_app",\n        "version": "2.1.0",\n        "extra": null\n      }\n    },\n    {\n      "id": "ORD-0002",\n      "userId": 2,\n      "items": [\n        {\n          "productId": "P1003",\n          "name": "Беспроводные наушники",\n          "quantity": 1,\n          "price": 14990,\n          "discount": 0,\n          "total": 14990,\n          "currency": "RUB",\n          "options": {}\n        }\n      ],\n      "totalPrice": 14990,\n      "discountTotal": 0,\n      "currency": "RUB",\n      "status": "processing",\n      "createdAt": "2026-01-10T13:05:00.000Z",\n      "updatedAt": null,\n      "deliveryAddress": null,\n      "comments": [],\n      "metadata": {}\n    }\n  ],\n\n  "config": {\n    "maxConcurrentRequests": 100,\n    "rateLimit": {\n      "requestsPerMinute": 60,\n      "burst": 120,\n      "window": "1m"\n    },\n    "logging": {\n      "level": "INFO",\n      "includeStacktrace": false,\n      "maskFields": ["password", "token", "secret"]\n    },\n    "features": {\n      "newDesign": true,\n      "betaEndpoints": false,\n      "experimental": null\n    },\n    "debug": false,\n    "timeouts": [\n      {\n        "service": "auth",\n        "seconds": 10\n      },\n      {\n        "service": "billing",\n        "seconds": 30\n      }\n    ],\n    "thirdParty": {\n      "analytics": {\n        "id": "UA-123456789-1",\n        "enabled": true\n      },\n      "payment": {\n        "gateway": "example_gateway",\n        "enabled": true,\n        "currencyWhitelist": ["RUB", "USD", "EUR"]\n      }\n    }\n  },\n\n  "stats": {\n    "totalUsers": 15000,\n    "activeUsers": 3200,\n    "newUsersLastWeek": 120,\n    "totalOrders": 45000,\n    "ordersToday": 187,\n    "revenueToday": 2845670.88,\n    "revenueLastMonth": 78912345.23,\n    "averageOrderValue": 1754.49,\n    "conversionRate": 0.125,\n    "errors": {\n      "lastHour": 42,\n      "totalLastDay": 127\n    }\n  },\n\n  "locales": {\n    "ru": {\n      "greeting": "Добро пожаловать!",\n      "thankYou": "Спасибо за покупку"\n    },\n    "en": {\n      "greeting": "Welcome!",\n      "thankYou": "Thank you for your purchase"\n    }\n  },\n\n  "emptyObject": {},\n  "emptyArray": [],\n  "nullValue": null,\n  "numberZero": 0,\n  "stringEmpty": "",\n  "numberNegative": -1,\n  "booleanFalse": false,\n  "booleanTrue": true\n}\n',invalid:'{\n  "id": 1,\n  "name": "Тест",\n  "status": "active",  // лишняя запятая\n}'}[n],this.renderLines(),this.validate()}exportJson(){const n=this.editor.value,e=new Blob([n],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`json-export-${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t),this.showStatus("JSON экспортирован!","success",!0)}onInput(){const n=!this.editor.value.trim();this.renderLines(),this.debounce(this.validate,400)(),n&&!this.editor.value.trim()&&this.hideStatus()}debounce(n,e){let t;return()=>{clearTimeout(t),t=setTimeout(n.bind(this),e)}}syncScroll(){this.lines.scrollTop=this.editor.scrollTop}renderLines(){const n=this.editor.value.split("\n");this.lines.innerHTML=n.map(((n,e)=>`<div class="json-validator__line-num">${e+1}</div>`)).join("")}handleBtn(n){const e={check:()=>this.validate(),format:()=>this.format(),minify:()=>this.minify(),clear:()=>this.clear()};e[n]?.()}validate(){const n=this.editor.value.trim();if(this.panel.classList.remove("json-validator__panel--error"),this.clearErrors(),n)try{JSON.parse(n),this.showStatus("JSON валиден!","success",!0)}catch(n){this.panel.classList.add("json-validator__panel--error");const e=this.getErrorLine(n.message);this.highlightError(e),this.showStatus(`Строка ${e}: ${n.message}`,"error",!1)}else this.hideStatus()}getErrorLine(n){const e=n.match(/position (\d+)/);if(!e)return 1;const t=parseInt(e[1]);return this.editor.value.slice(0,t).split("\n").length}highlightError(n){this.clearErrors();const e=this.lines.children[n-1];e&&(e.classList.add("json-validator__line-num--error"),this.editor.scrollTop=20*(n-1))}clearErrors(){this.lines.querySelectorAll(".json-validator__line-num--error").forEach((n=>{n.classList.remove("json-validator__line-num--error")}))}format(){try{const n=JSON.parse(this.editor.value);this.editor.value=JSON.stringify(n,null,2),this.renderLines(),this.validate()}catch{this.editor.value?this.showStatus("Невалидный JSON!","error",!0):this.showStatus("Введите JSON!","error",!0)}}minify(){try{const n=JSON.parse(this.editor.value);this.editor.value=JSON.stringify(n),this.renderLines(),this.validate()}catch{this.editor.value?this.showStatus("Невалидный JSON!","error",!0):this.showStatus("Введите JSON!","error",!0)}}clear(){this.editor.value="",this.renderLines(),this.panel.classList.remove("json-validator__panel--error"),this.hideStatus()}copy(){navigator.clipboard.writeText(this.editor.value).then((()=>{this.showStatus("Скопировано!","success",!0)})).catch((()=>{this.showStatus("Ошибка копирования","error",!0)}))}showStatus(n,e,t=!1){this.statusTimeout&&(clearTimeout(this.statusTimeout),this.statusTimeout=null),this.status.innerHTML=`\n            <span class="json-validator__status-icon">${"success"===e?"✅":"❌"}</span>\n            <span>${n}</span>\n        `,this.status.className=`json-validator__status json-validator__status--${e}`,this.status.classList.remove("json-validator__status--hidden"),t&&(this.statusTimeout=setTimeout(this.hideStatus.bind(this),3e3))}hideStatus(){this.statusTimeout&&(clearTimeout(this.statusTimeout),this.statusTimeout=null),this.status.classList.add("json-validator__status--hidden")}};